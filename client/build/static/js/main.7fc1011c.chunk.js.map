{"version":3,"sources":["components/data/Point.ts","components/data/Rect.ts","components/bullet.ts","components/data/Size.ts","components/data/Circle.ts","components/utils/collision.ts","components/tank/tankBase.ts","components/tank/tankMe.ts","components/tank/tankPlayer.ts","components/tank/tankRobot.ts","components/utils/urls.ts","components/message.ts","components/game.ts","components/game-container.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["Point","x","y","this","p","angle","Math","cos","sin","floatDigit","toFixed","Rect","position","rotation","size","hw","w","hh","h","rotate","add","vertexes","getVertexes","vertexesY","map","vertexesX","top","min","right","max","bottom","left","Bullet","p5","id","p0","radius","speed","isHit","offset","circle","Size","Circle","center","isRectInBound","rect1","rect2","b1","getBound","b2","getTriangleArea","pa","pb","pc","abs","isCircleHitRect","rect","p1","p2","p3","p4","cp","rectArea","Tank","config","initStatus","halfSize","speedMove","speedRotate","speedBullet","body","battleField","bullets","allowFire","debug","isLive","height","PI","width","textSize","push","fill","translate","pop","drawBullets","debugInfo","forEach","text","toString","b","draw","filter","cb","rb","isCircleInBound","TankMe","message","keyIsDown","bullet","sendMessage","keyReleased","keyCode","stroke","TankBase","TankPlayer","TankRobot","lastMoveTime","minMoveTime","move","Date","now","forward","randomMove","curTime","floor","random","getWebSockedDomain","loc","window","location","wsUri","protocol","host","Message","ws","WebSocket","encodeURIComponent","Promise","resolve","addEventListener","callback","evt","data","msg","send","Game","sketch","me","enemies","players","canvas","score","setup","setupGame","runGame","Messge","curCanvas","document","querySelector","canvasParentId","remove","createCanvas","parent","getConnection","getRandTankStatus","listenOnMessage","handleMessages","bind","background","playerId","checkIfHit","typeIdx","indexOf","messageType","substring","messageData","updatePlayers","updateBullets","updateExit","dataParse","JSON","parse","playerTankData","split","player","updateStatus","playerTank","r","addBullet","enemyCount","length","allTanks","tankId","tank","tb","tbCircle","enemy","console","log","GameContainer","container","useRef","useEffect","innerWidth","innerHeight","current","style","ref","App","className","Boolean","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.7fc1011c.chunk.js","sourcesContent":["class Point {\r\n  x: number;\r\n  y: number;\r\n  constructor(x:number, y:number) {\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n\r\n  add(p:Point):Point {\r\n    return new Point(this.x + p.x, this.y + p.y);\r\n  }\r\n\r\n  sub(p:Point):Point {\r\n    return new Point(this.x - p.x, this.y - p.y);\r\n  }\r\n\r\n  rotate(angle: number): Point {\r\n    const x1 = this.x * Math.cos(angle) - this.y * Math.sin(angle);\r\n    const y1 = this.x * Math.sin(angle) + this.y * Math.cos(angle);\r\n    return new Point(x1, y1);\r\n  }\r\n\r\n  toString(floatDigit: number): string {\r\n    return `${this.x.toFixed(floatDigit)},\\n${this.y.toFixed(floatDigit)}`;\r\n  }\r\n}\r\n\r\nexport default Point;","import Point from './Point';\r\nimport Size from './Size';\r\nimport { Bound } from './Types';\r\n\r\nclass Rect {\r\n  position: Point;\r\n  rotation: number;\r\n  size: Size;\r\n\r\n  constructor(position: Point, rotation: number, size: Size) {\r\n    this.position = position;\r\n    this.rotation = rotation;\r\n    this.size = size;\r\n  }\r\n\r\n  getVertexes():Point[] {\r\n    const hw = this.size.w / 2;\r\n    const hh = this.size.h / 2; \r\n  \r\n    return [\r\n      new Point(-hw, -hh).rotate(this.rotation).add(this.position), // top left\r\n      new Point(hw, -hh).rotate(this.rotation).add(this.position), // top right\r\n      new Point(-hw, hh).rotate(this.rotation).add(this.position), // bottom left\r\n      new Point(hw, hh).rotate(this.rotation).add(this.position) // bottom right\r\n    ];\r\n  }\r\n\r\n  getBound(): Bound {\r\n    const vertexes: Point[] = this.getVertexes();\r\n    const vertexesY: number[] = vertexes.map(p => p.y);\r\n    const vertexesX: number[] = vertexes.map(p => p.x);\r\n    return {\r\n      top: Math.min(...vertexesY),\r\n      right: Math.max(...vertexesX),\r\n      bottom: Math.max(...vertexesY),\r\n      left: Math.min(...vertexesX)\r\n    };\r\n  }\r\n}\r\n\r\nexport default Rect;","import p5 from 'p5';\r\nimport Point from './data/Point';\r\n\r\nclass Bullet {\r\n  p5: p5;\r\n  id: string;\r\n  radius: number;\r\n  position: Point;\r\n  rotation: number;\r\n  speed: number;\r\n  isHit = false;\r\n\r\n  constructor(p5: p5, id: string, p0: Point, rotation: number) {\r\n    this.p5 = p5;\r\n    this.id = id;\r\n    this.radius = 5;\r\n    this.position = new Point(p0.x, p0.y);\r\n    this.rotation = rotation;\r\n    this.speed = 10;\r\n  }\r\n\r\n  draw(): void {\r\n    const p5 = this.p5;\r\n    const offset = new Point(this.speed * Math.cos(this.rotation), this.speed * Math.sin(this.rotation));\r\n    this.position = this.position.add(offset);\r\n\r\n    p5.circle(this.position.x, this.position.y, this.radius);\r\n  }\r\n}\r\n\r\nexport default Bullet;","class Size {\r\n  // we assume w >= h;\r\n  w: number;\r\n  h: number;\r\n  constructor(w: number, h: number) {\r\n    this.w = w;\r\n    this.h = h;\r\n  }\r\n}\r\n\r\nexport default Size;","import Point from './Point';\r\nimport { Bound } from './Types';\r\n\r\nclass Circle {\r\n  center: Point;\r\n  radius: number;\r\n\r\n  constructor(center: Point, radius: number) {\r\n    this.center = center;\r\n    this.radius = radius;\r\n  }\r\n\r\n  getBound(): Bound {\r\n    return {\r\n      top: this.center.y - this.radius,\r\n      right: this.center.x + this.radius,\r\n      bottom: this.center.y + this.radius,\r\n      left: this.center.x - this.radius\r\n    };\r\n  }\r\n}\r\n\r\nexport default Circle;","import Rect from '../data/Rect';\r\nimport Circle from '../data/Circle';\r\nimport Point from '../data/Point';\r\n\r\nexport const isRectInBound = (rect1: Rect, rect2: Rect): boolean => {\r\n  const b1 = rect1.getBound();\r\n  const b2 = rect2.getBound();\r\n\r\n  return b1.top >= b2.top && b1.right <= b2.right && b1.bottom <= b2.bottom && b1.left >= b2.left;\r\n};\r\n\r\nexport const isCircleInBound = (circle: Circle, rect: Rect): boolean => {\r\n  const cb = circle.getBound();\r\n  const rb = rect.getBound();\r\n  \r\n  return cb.top >= rb.top && cb.right <= rb.right && cb.bottom <= rb.bottom && cb.left >= rb.left;\r\n};\r\n\r\nexport const getTriangleArea = (pa: Point, pb: Point, pc: Point): number => {\r\n  return Math.abs((pb.x*pa.y-pa.x*pb.y)+(pc.x*pb.y-pb.x*pc.y)+(pa.x*pc.y-pc.x*pa.y)) / 2;\r\n};\r\n\r\nexport const isCircleHitRect = (circle: Circle, rect: Rect): boolean => {\r\n  // TODO need to extend the rect because circle has radius\r\n  const [p1, p2, p3, p4] = rect.getVertexes();\r\n  const cp = circle.center;\r\n  const rectArea = rect.size.w * rect.size.h;\r\n  const area = getTriangleArea(p1, p2, cp) + getTriangleArea(p2, p3, cp) + getTriangleArea(p3, p4, cp) + getTriangleArea(p4, p1, cp);\r\n  return area <= rectArea;\r\n};\r\n","import { GameConfigType, TankStatus } from '../data/Types';\r\nimport p5 from 'p5';\r\nimport Point from '../data/Point';\r\nimport Size from '../data/Size';\r\nimport Rect from '../data/Rect';\r\nimport Circle from '../data/Circle';\r\nimport Bullet from '../bullet';\r\nimport { isCircleInBound } from '../utils/collision';\r\n\r\nclass Tank {\r\n  p5: p5;\r\n  config: GameConfigType;\r\n  size: Size;\r\n  halfSize: Size;\r\n  position: Point;\r\n  rotation: number;\r\n  speedMove: number;\r\n  speedRotate: number;\r\n  speedBullet: number;\r\n  body: Rect;\r\n  battleField: Rect;\r\n  id: string;\r\n  bullets: Bullet[];\r\n  allowFire = true;\r\n  debug: boolean;\r\n  isLive = true;\r\n  constructor(p5: p5, config: GameConfigType, id: string, initStatus?: TankStatus) {\r\n    this.p5 = p5;\r\n    this.config = config;\r\n    this.size = {w: 48, h: 32};\r\n    this.halfSize = {w: this.size.w / 2, h: this.size.h / 2};\r\n    if (initStatus) {\r\n      this.position = initStatus.position;\r\n      this.rotation = initStatus.rotation;\r\n    } else {\r\n      this.position = new Point(50, this.config.height-80);\r\n      this.rotation = 0; //0 - 2pi deg\r\n    }\r\n    this.speedMove = 2;\r\n    this.speedRotate = p5.PI/40;\r\n    this.speedBullet = 5;\r\n    this.body = new Rect(this.position, this.rotation, this.size);\r\n    this.battleField = new Rect(new Point(config.width / 2, config.height / 2), 0, new Size(config.width, config.height));\r\n    this.id = id;\r\n    this.bullets = [];\r\n    this.debug = false;\r\n  }\r\n\r\n  draw():void {\r\n    const p5 = this.p5;\r\n    p5.textSize(12);\r\n\r\n    // plot tank\r\n    p5.push();\r\n    p5.fill(255, 255, 255);\r\n    p5.translate(this.position.x, this.position.y);\r\n    p5.rotate(this.rotation);\r\n    p5.rect(-this.halfSize.w, -this.halfSize.h, this.size.w, this.size.h, 5);\r\n    p5.rect(0 , -this.halfSize.h / 4, this.size.w , this.halfSize.h / 2);\r\n\r\n    // plot debug info\r\n    p5.pop();\r\n    // plot bullets\r\n    p5.fill(255, 255, 0);\r\n    this.drawBullets();\r\n\r\n    if (this.debug) {\r\n      p5.fill(0, 0, 255);\r\n      this.debugInfo();\r\n    }\r\n  }\r\n\r\n  debugInfo(): void {\r\n    const p5 = this.p5;\r\n    const rect = new Rect(this.position, this.rotation, this.size);\r\n    const boundingP = rect.getVertexes();\r\n    boundingP.forEach(p => {\r\n      p5.text(p.toString(1), p.x, p.y);\r\n    });\r\n  }\r\n\r\n  drawBullets(): void {\r\n    this.bullets.forEach(b => {\r\n      b.draw();\r\n    });\r\n    this.bullets = this.bullets.filter(b => {\r\n      const circle = new Circle(b.position, b.radius);\r\n      return isCircleInBound(circle, this.battleField);\r\n    });\r\n  }\r\n\r\n  nomalizePostion(p: Point): Point {\r\n    return new Point(p.x/this.config.width, p.y/this.config.height);\r\n  }\r\n\r\n  denomalizePosition(p: Point): Point {\r\n    return new Point(p.x*this.config.width, p.y*this.config.height);\r\n  }\r\n}\r\n\r\nexport default Tank;","import { GameConfigType, TankStatus } from '../data/Types';\r\nimport p5 from 'p5';\r\nimport Point from '../data/Point';\r\nimport Rect from '../data/Rect';\r\nimport Bullet from '../bullet';\r\nimport TankBase from './tankBase';\r\nimport Message from '../message';\r\nimport { isRectInBound } from '../utils/collision';\r\n\r\nclass TankMe extends TankBase {\r\n  message: Message;\r\n  constructor(p5: p5, config: GameConfigType, id: string, message: Message, initStatus?: TankStatus) {\r\n    super(p5, config, id, initStatus);\r\n    this.message = message;\r\n  }\r\n  draw(): void {\r\n    const p5 = this.p5;\r\n    let rotation = this.rotation;\r\n    let position = new Point(this.position.x, this.position.y);\r\n    // w: 87, s: 83, a:65, d:68\r\n    if (p5.keyIsDown(65)) {\r\n      rotation -= this.speedRotate;\r\n    }\r\n    if (p5.keyIsDown(68)) {\r\n      rotation += this.speedRotate;\r\n    }\r\n    rotation %= 2 * p5.PI;\r\n    let speed = 0;\r\n    if (p5.keyIsDown(87)) {\r\n      speed = this.speedMove;\r\n    }\r\n    if (p5.keyIsDown(83)) {\r\n      speed = -this.speedMove;\r\n    }\r\n\r\n    rotation %= 2 * p5.PI;\r\n\r\n    const offset = new Point(speed * Math.cos(rotation), speed * Math.sin(rotation));\r\n    position = position.add(offset);\r\n\r\n    const body = new Rect(position, rotation, this.size);\r\n\r\n    if (isRectInBound(body, this.battleField)) {\r\n      this.position = position;\r\n      this.rotation = rotation;\r\n      this.body = body;\r\n    }\r\n\r\n    if (p5.keyIsDown(32) && this.allowFire) {\r\n      // fire a bullet\r\n      this.allowFire = false;\r\n      const offset = new Point(this.size.w * Math.cos(this.rotation), this.size.w * Math.sin(this.rotation));\r\n      const bullet = new Bullet(this.p5, this.id, this.position.add(offset), this.rotation);\r\n      this.message.sendMessage(`blt,${bullet.position.x},${bullet.position.y},${bullet.rotation}`);\r\n      this.bullets.push(bullet);\r\n    }\r\n\r\n    p5.keyReleased = () => {\r\n      if (p5.keyCode == 32) {\r\n        this.allowFire = true;\r\n      }\r\n    };\r\n    p5.stroke(255, 0, 0);\r\n    this.message.sendMessage(`pos,${this.position.x},${this.position.y},${this.rotation}`);\r\n    super.draw();\r\n  }\r\n}\r\n\r\nexport default TankMe;","import Point from '../data/Point';\r\nimport Rect from '../data/Rect';\r\nimport TankBase from './tankBase';\r\nimport Bullet from '../bullet';\r\n\r\nclass TankPlayer extends TankBase {\r\n  updateStatus(position: Point, rotation: number): void {\r\n    this.position = position;\r\n    this.rotation = rotation;\r\n    this.body = new Rect(position, rotation, this.size);\r\n  }\r\n\r\n  draw(): void {\r\n    this.p5.stroke(0, 0, 255);\r\n    super.draw();\r\n  }\r\n\r\n  addBullet(x: number, y: number, rotation: number): void {\r\n    const bullet = new Bullet(this.p5, this.id, new Point(x, y), rotation);\r\n    this.bullets.push(bullet);\r\n  }\r\n}\r\n\r\nexport default TankPlayer;","import { GameConfigType, TankStatus, Move } from '../data/Types';\r\nimport p5 from 'p5';\r\nimport Point from '../data/Point';\r\nimport Rect from '../data/Rect';\r\nimport TankBase from './tankBase';\r\nimport { isRectInBound } from '../utils/collision';\r\n\r\nclass TankRobot extends TankBase {\r\n  lastMoveTime: number;\r\n  minMoveTime: number;\r\n  move: Move;\r\n  constructor(p5: p5, config: GameConfigType, id: string, initStatus?: TankStatus) {\r\n    super(p5, config, id, initStatus);\r\n    this.speedMove = 1;\r\n    this.speedRotate = p5.PI/80;\r\n    this.speedBullet = 2.5;\r\n    this.lastMoveTime = Date.now();\r\n    this.minMoveTime = 3000;\r\n    this.move = {\r\n      forward: 0, \r\n      rotation: 0\r\n    };\r\n  }\r\n  draw(): void {\r\n    this.randomMove();\r\n    //this.p5.stroke(0, 255, 255);\r\n    super.draw();\r\n  }\r\n\r\n  randomMove(): void {\r\n    const p5 = this.p5;\r\n\r\n    const curTime = Date.now();\r\n\r\n    if (curTime < this.lastMoveTime + this.minMoveTime) {\r\n      // still less that last move, do nothing\r\n    } else {\r\n      this.lastMoveTime = curTime;\r\n      // get move status\r\n      this.move.forward = Math.floor(Math.random()*10); // 0-9\r\n      this.move.rotation = Math.floor(Math.random()*10);\r\n    }\r\n\r\n    let speed = 0;\r\n    if (this.move.forward <= 1) {\r\n      // don't move\r\n      speed = 0;\r\n    } else if (this.move.forward <= 3){\r\n      // move backword\r\n      speed = -this.speedMove;\r\n    } else {\r\n      // move forward\r\n      speed = this.speedMove;\r\n    }\r\n\r\n    let rotation = this.rotation;\r\n    if (this.move.rotation <= 1) {\r\n      // rotate left\r\n      rotation -= this.speedRotate;\r\n    } else if (this.move.rotation <= 3) {\r\n      rotation += this.speedRotate;\r\n    }\r\n\r\n    rotation %= 2 * p5.PI;\r\n\r\n    const offset = new Point(speed * Math.cos(rotation), speed * Math.sin(rotation));\r\n    let position = new Point(this.position.x, this.position.y);\r\n    position = position.add(offset);\r\n\r\n    const body = new Rect(position, rotation, this.size);\r\n\r\n    if (isRectInBound(body, this.battleField)) {\r\n      this.position = position;\r\n      this.rotation = rotation;\r\n      this.body = body;\r\n    }\r\n  }\r\n}\r\n\r\nexport default TankRobot;","export const getWebSockedDomain = (): string => {\r\n  const loc = window.location;\r\n  let wsUri = 'wss';\r\n  if (loc.protocol === 'http:') {\r\n    wsUri = 'ws:';\r\n  }\r\n  wsUri += '//' + loc.host;\r\n  return wsUri;\r\n};\r\n\r\nexport const getRandomNumber = (): string => {\r\n  const randomId = Math.random()*10000;\r\n  return randomId.toFixed(0);\r\n};","import { MessageListener } from './data/Types';\r\nimport { getWebSockedDomain } from './utils/urls';\r\n\r\nclass Message {\r\n  ws: WebSocket;\r\n  id: string;\r\n  constructor(id: string) {\r\n    this.id = id;\r\n  }\r\n\r\n  async getConnection(): Promise<boolean> {\r\n    const wsUri = getWebSockedDomain();\r\n    this.ws = new WebSocket(`${wsUri}/websockets?id=${encodeURIComponent(this.id)}`);\r\n\r\n    return new Promise((resolve) => {\r\n      // Connection opened\r\n      this.ws.addEventListener('open', () => {\r\n        resolve(true);\r\n      });\r\n      this.ws.addEventListener('error', () => {\r\n        resolve(false);\r\n      });\r\n    });\r\n  }\r\n\r\n  listenOnMessage(callback: MessageListener): void {\r\n    this.ws.addEventListener('message', evt => {\r\n      callback(evt.data);\r\n    });\r\n  }\r\n\r\n  sendMessage(msg: string): void {\r\n    this.ws.send(msg);\r\n  }\r\n}\r\n\r\nexport default Message;","import { GameConfigType } from './data/Types';\r\nimport TankMe from './tank/tankMe';\r\nimport TankPlayer from './tank/tankPlayer';\r\nimport TankRobot from './tank/tankRobot';\r\nimport p5 from 'p5';\r\nimport Point from './data/Point';\r\nimport { TankStatus } from './data/Types';\r\nimport { isCircleHitRect } from './utils/collision';\r\nimport { getRandomNumber } from './utils/urls';\r\nimport Circle from './data/Circle';\r\nimport Messge from './message';\r\nimport Message from './message';\r\n\r\nclass Game {\r\n  config: GameConfigType;\r\n  p5: p5;\r\n  sketch: p5;\r\n  me: TankMe;\r\n  enemies: TankRobot[];\r\n  players: {[key: string]: TankPlayer};\r\n  canvas: p5.Renderer;\r\n  score: number;\r\n  message: Message;\r\n  id: string;\r\n  constructor(config: GameConfigType) {\r\n    this.config = config;\r\n    this.p5 = new p5((sketch) => {\r\n      sketch.setup = () => {\r\n        this.setupGame(sketch);\r\n      };\r\n      sketch.draw = () => {\r\n        this.runGame();\r\n      };\r\n    });\r\n    this.enemies = [];\r\n    this.players = {};\r\n    this.id = getRandomNumber();\r\n    this.message = new Messge(this.id);\r\n    this.score = 0;\r\n  }\r\n\r\n  async setupGame(sketch: p5) {\r\n    this.sketch = sketch;\r\n    // remove the previous canvas\r\n    const curCanvas = document.querySelector(`#${this.config.canvasParentId} canvas`);\r\n    if(curCanvas) {\r\n      curCanvas.remove();\r\n    }\r\n    this.canvas = sketch.createCanvas(this.config.width, this.config.height);\r\n    this.canvas.parent(this.config.canvasParentId);\r\n\r\n    const isConnected = await this.message.getConnection();\r\n    if (isConnected) {\r\n      this.me = new TankMe(this.p5, this.config, this.id, this.message, this.getRandTankStatus());\r\n      this.message.listenOnMessage(this.handleMessages.bind(this));\r\n    }\r\n  }\r\n\r\n  runGame(): void {\r\n    //clear all canvas\r\n    this.sketch.background('#F3F3F3');\r\n    const p5 = this.p5;\r\n    p5.fill(0, 0, 255);\r\n    p5.stroke(0, 0, 255);\r\n    p5.textSize(32);\r\n    this.p5.text(`Score: ${this.score}`, 20, 40);\r\n\r\n    if (this.me) {\r\n      this.me.draw();\r\n    }\r\n\r\n    for(const playerId in this.players) {\r\n      const p = this.players[playerId];\r\n      p.draw();\r\n    }\r\n    \r\n    this.checkIfHit();\r\n  }\r\n\r\n  handleMessages(data: string): void {\r\n    const typeIdx = data.indexOf(',');\r\n    const messageType = data.substring(0, typeIdx);\r\n    const messageData = data.substring(typeIdx + 1);\r\n    switch (messageType) {\r\n      case 'pos':\r\n        this.updatePlayers(messageData);\r\n        break;\r\n      case 'blt':\r\n        this.updateBullets(messageData);\r\n        break;\r\n      case 'ext':\r\n        this.updateExit(messageData);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n  updatePlayers(data: string): void {\r\n    const dataParse = JSON.parse(data);\r\n    // remove my own tank\r\n    delete dataParse[this.id];\r\n    for (const playerId in dataParse) {\r\n      const playerTankData = dataParse[playerId].split(',');\r\n      const position = new Point(+playerTankData[0], +playerTankData[1]);\r\n      const rotation = +playerTankData[2];\r\n      const player = this.players[playerId];\r\n      if (player) {\r\n        player.updateStatus(position, rotation);\r\n      } else {\r\n        const playerTank = new TankPlayer(this.p5, this.config, playerId);\r\n        playerTank.updateStatus(position, rotation);\r\n        this.players[playerId] = playerTank;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateBullets(data: string): void {\r\n    const [id, x, y, r] = data.split(',');\r\n    // skip my own bullet\r\n    if (id === this.id) {\r\n      return;\r\n    }\r\n    // add the bullet to the player\r\n    const player = this.players[id];\r\n    if (player) {\r\n      player.addBullet(+x, +y, +r);\r\n    }\r\n  }\r\n\r\n  updateExit(id: string): void {\r\n    delete this.players[id];\r\n  }\r\n\r\n  addEnemy(): void {\r\n    const enemyCount = this.enemies.length;\r\n    this.enemies.push(new TankRobot(this.p5, this.config, `robot${enemyCount}`, this.getRandTankStatus()));\r\n  }\r\n\r\n  getRandTankStatus(): TankStatus {\r\n    const randPoint = new Point(Math.random()*this.config.width, Math.random()*this.config.height);\r\n    const randStatus = {\r\n      position: randPoint,\r\n      rotation: Math.random()* 2 * this.p5.PI\r\n    };\r\n    return randStatus;\r\n  }\r\n\r\n  checkIfHit(): void {\r\n    const allTanks = {...this.players, [this.id]: this.me};\r\n\r\n    for (const tankId in allTanks) {\r\n      const tank = allTanks[tankId];\r\n      if (!tank) {\r\n        continue;\r\n      }\r\n      for (const tb of tank.bullets) {\r\n        if (tb.isHit) {\r\n          continue;\r\n        }\r\n        const tbCircle = new Circle(tb.position, tb.radius);\r\n        for (const playerId in allTanks) {\r\n          if (playerId != tankId){\r\n            // never check if hit self\r\n            const enemy = allTanks[playerId];\r\n            if (isCircleHitRect(tbCircle, enemy.body)) {\r\n              console.log(`tank ${tankId} bullet hits tank ${playerId}`);\r\n              if (tankId == this.id) {\r\n                this.score++;\r\n              }\r\n              tb.isHit = true;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      tank.bullets = tank.bullets.filter(tb => !tb.isHit);\r\n    }\r\n  }\r\n}\r\n\r\nexport default Game;","import React, {useEffect, useRef} from 'react';\r\nimport Game from './game';\r\nimport './game-container.scss';\r\n\r\nconst GameContainer = (): JSX.Element => {\r\n  const container = useRef<HTMLDivElement>(null);\r\n  useEffect(() => {\r\n    const width = window.innerWidth;\r\n    const height = window.innerHeight;\r\n    const current = container.current;\r\n    if (current) {\r\n      current.style.width = `${width}px`;\r\n      current.style.height = `${height}px`;\r\n    }\r\n    new Game({\r\n      width,\r\n      height,\r\n      canvasParentId: 'game-container'\r\n    });\r\n  }, []);\r\n  return <div id='game-container' ref={container}></div>;\r\n};\r\n\r\nexport default GameContainer;","import React from 'react';\r\nimport './App.css';\r\nimport GameContainer from './components/game-container';\r\n\r\nfunction App():JSX.Element {\r\n  return (\r\n    <div className=\"App\">\r\n      <GameContainer />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","/* eslint-disable @typescript-eslint/no-explicit-any*/\r\n\r\n// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n  // [::1] is the IPv6 localhost address.\r\n  window.location.hostname === '[::1]' ||\r\n  // 127.0.0.0/8 are considered localhost for IPv4.\r\n  window.location.hostname.match(\r\n    /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n  )\r\n);\r\n\r\nexport const register = (config: any): void => {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n  // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n        'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nfunction registerValidSW(swUrl: string, config: any) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config: any) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n    (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport const unregister = (): void => {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n};\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}