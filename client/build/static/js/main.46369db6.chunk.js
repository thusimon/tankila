(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{28:function(t,e,i){},29:function(t,e,i){},32:function(t,e,i){},33:function(t,e,i){},35:function(t,e,i){},36:function(t,e,i){"use strict";i.r(e);var s=i(6),n=i(7),o=i.n(n),a=i(16),r=i.n(a),h=(i(28),i(12)),d=(i(29),Object(n.createContext)({gameData:{id:"",engine:!0},setGameData:function(){return console.warn("no data provider")}})),c=function(){return Object(n.useContext)(d)},u=i(21),l=i(10),v=i(4),p=i(11),f=i.n(p),m=i(15),y=i(0),w=i(1),b=i(9),g=i(8),k=i(2),j=i(3),O=function(){function t(e,i){Object(y.a)(this,t),this.x=void 0,this.y=void 0,this.x=e,this.y=i}return Object(w.a)(t,[{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"sub",value:function(e){return new t(this.x-e.x,this.y-e.y)}},{key:"rotate",value:function(e){return new t(this.x*Math.cos(e)-this.y*Math.sin(e),this.x*Math.sin(e)+this.y*Math.cos(e))}},{key:"toString",value:function(t){return"".concat(this.x.toFixed(t),",\n").concat(this.y.toFixed(t))}}]),t}(),x=i(18),M=function(){function t(e,i,s){Object(y.a)(this,t),this.position=void 0,this.rotation=void 0,this.size=void 0,this.position=e,this.rotation=i,this.size=s}return Object(w.a)(t,[{key:"getVertexes",value:function(){var t=this.size.w/2,e=this.size.h/2;return[new O(-t,-e).rotate(this.rotation).add(this.position),new O(t,-e).rotate(this.rotation).add(this.position),new O(-t,e).rotate(this.rotation).add(this.position),new O(t,e).rotate(this.rotation).add(this.position)]}},{key:"getBound",value:function(){var t=this.getVertexes(),e=t.map((function(t){return t.y})),i=t.map((function(t){return t.x}));return{top:Math.min.apply(Math,Object(x.a)(e)),right:Math.max.apply(Math,Object(x.a)(i)),bottom:Math.max.apply(Math,Object(x.a)(e)),left:Math.min.apply(Math,Object(x.a)(i))}}}]),t}(),S=function(){function t(e,i,s,n){Object(y.a)(this,t),this.p5=void 0,this.id=void 0,this.radius=void 0,this.position=void 0,this.rotation=void 0,this.speed=void 0,this.isHit=!1,this.p5=e,this.id=i,this.radius=5,this.position=new O(s.x,s.y),this.rotation=n,this.speed=10}return Object(w.a)(t,[{key:"draw",value:function(){var t=this.p5,e=new O(this.speed*Math.cos(this.rotation),this.speed*Math.sin(this.rotation));this.position=this.position.add(e),t.circle(this.position.x,this.position.y,this.radius)}}]),t}(),R=function t(e,i){Object(y.a)(this,t),this.w=void 0,this.h=void 0,this.w=e,this.h=i},B=function(){function t(e,i){Object(y.a)(this,t),this.center=void 0,this.radius=void 0,this.center=e,this.radius=i}return Object(w.a)(t,[{key:"getBound",value:function(){return{top:this.center.y-this.radius,right:this.center.x+this.radius,bottom:this.center.y+this.radius,left:this.center.x-this.radius}}}]),t}(),z=function(t,e,i){return Math.abs(e.x*t.y-t.x*e.y+(i.x*e.y-e.x*i.y)+(t.x*i.y-i.x*t.y))/2},P=function(t,e){var i=e.getVertexes(),s=Object(h.a)(i,4),n=s[0],o=s[1],a=s[2],r=s[3],d=t.center,c=e.size.w*e.size.h;return z(n,o,d)+z(o,a,d)+z(a,r,d)+z(r,n,d)<=c},C=function(){function t(e,i,s,n){Object(y.a)(this,t),this.p5=void 0,this.config=void 0,this.size=void 0,this.halfSize=void 0,this.position=void 0,this.rotation=void 0,this.speedMove=void 0,this.speedRotate=void 0,this.speedBullet=void 0,this.body=void 0,this.battleField=void 0,this.id=void 0,this.bullets=void 0,this.allowFire=!0,this.debug=void 0,this.isLive=!0,this.p5=e,this.config=i,this.size={w:48,h:32},this.halfSize={w:this.size.w/2,h:this.size.h/2},n?(this.position=n.position,this.rotation=n.rotation):(this.position=new O(50,this.config.height-80),this.rotation=0),this.speedMove=2,this.speedRotate=e.PI/40,this.speedBullet=5,this.body=new M(this.position,this.rotation,this.size),this.battleField=new M(new O(i.width/2,i.height/2),0,new R(i.width,i.height)),this.id=s,this.bullets=[],this.debug=!1}return Object(w.a)(t,[{key:"draw",value:function(t){var e=this.p5;e.stroke(t),e.textSize(12),e.push(),e.fill(255,255,255),e.translate(this.position.x,this.position.y),e.rotate(this.rotation),e.rect(-this.halfSize.w,-this.halfSize.h,this.size.w,this.size.h,5),e.rect(0,-this.halfSize.h/4,this.size.w,this.halfSize.h/2),e.stroke(255,255,255),e.fill(t),this.p5.text(this.id,1-this.halfSize.w,0),e.pop(),e.fill(t),this.drawBullets(),this.debug&&(e.fill(0,0,255),this.debugInfo())}},{key:"debugInfo",value:function(){var t=this.p5;new M(this.position,this.rotation,this.size).getVertexes().forEach((function(e){t.text(e.toString(1),e.x,e.y)}))}},{key:"drawBullets",value:function(){var t=this;this.bullets.forEach((function(t){t.draw()})),this.bullets=this.bullets.filter((function(e){return function(t,e){var i=t.getBound(),s=e.getBound();return i.top>=s.top&&i.right<=s.right&&i.bottom<=s.bottom&&i.left>=s.left}(new B(e.position,e.radius),t.battleField)}))}},{key:"nomalizePostion",value:function(t){return new O(t.x/this.config.width,t.y/this.config.height)}},{key:"denomalizePosition",value:function(t){return new O(t.x*this.config.width,t.y*this.config.height)}}]),t}(),D=function(t){Object(k.a)(i,t);var e=Object(j.a)(i);function i(t,s,n,o,a){var r;return Object(y.a)(this,i),(r=e.call(this,t,s,n,a)).message=void 0,r.message=o,r}return Object(w.a)(i,[{key:"draw",value:function(){var t=this,e=this.p5,s=this.rotation,n=new O(this.position.x,this.position.y);e.keyIsDown(65)&&(s-=this.speedRotate,this.sendRotateLeft(!0)),e.keyIsDown(68)&&(s+=this.speedRotate,this.sendRotateRight(!0)),s%=2*e.PI;var o=0;e.keyIsDown(87)&&(o=this.speedMove,this.sendMoveForward(!0)),e.keyIsDown(83)&&(o=-this.speedMove,this.sendMoveBackword(!0));var a=new O(o*Math.cos(s),o*Math.sin(s));n=n.add(a);var r=new M(n,s,this.size);if(this.position=n,this.rotation=s,this.body=r,e.keyIsDown(32)&&this.allowFire){this.allowFire=!1;var h=new O(this.size.w*Math.cos(this.rotation),this.size.w*Math.sin(this.rotation)),d=new S(this.p5,this.id,this.position.add(h),this.rotation);this.message.sendMessage("blt,".concat(d.position.x,",").concat(d.position.y,",").concat(d.rotation)),this.bullets.push(d)}e.keyReleased=function(){32==e.keyCode&&(t.allowFire=!0),65==e.keyCode&&t.sendRotateLeft(!1),68==e.keyCode&&t.sendRotateRight(!1),87==e.keyCode&&t.sendMoveForward(!1),83==e.keyCode&&t.sendMoveBackword(!1)},Object(b.a)(Object(g.a)(i.prototype),"draw",this).call(this,e.color(255,0,0))}},{key:"sendMoveForward",value:function(t){this.message.sendMessage("fwd,".concat(t?"1":"0"))}},{key:"sendMoveBackword",value:function(t){this.message.sendMessage("bwd,".concat(t?"1":"0"))}},{key:"sendRotateLeft",value:function(t){this.message.sendMessage("rl,".concat(t?"1":"0"))}},{key:"sendRotateRight",value:function(t){this.message.sendMessage("rr,".concat(t?"1":"0"))}}]),i}(C),I=function(t){Object(k.a)(i,t);var e=Object(j.a)(i);function i(t,s,n,o){var a;return Object(y.a)(this,i),(a=e.call(this,t,s,n,o)).tankCommands=void 0,a.tankCommands={fwd:!1,bwd:!1,rl:!1,rr:!1,blt:!1},a}return Object(w.a)(i,[{key:"updateCommands",value:function(t){this.tankCommands=Object(l.a)(Object(l.a)({},this.tankCommands),t)}},{key:"updateStatus",value:function(t,e){this.position=t,this.rotation=e,this.body=new M(t,e,this.size)}},{key:"draw",value:function(){var t=this.p5,e=this.tankCommands,s=this.rotation,n=new O(this.position.x,this.position.y);e.rl&&(s-=this.speedRotate),e.rr&&(s+=this.speedRotate),s%=2*t.PI;var o=0;e.fwd&&(o=this.speedMove),e.bwd&&(o=-this.speedMove);var a=new O(o*Math.cos(s),o*Math.sin(s));n=n.add(a);var r=new M(n,s,this.size);this.position=n,this.rotation=s,this.body=r,Object(b.a)(Object(g.a)(i.prototype),"draw",this).call(this,t.color(0,0,255))}},{key:"addBullet",value:function(t,e,i){var s=new S(this.p5,this.id,new O(t,e),i);this.bullets.push(s)}}]),i}(C),F=function(t){Object(k.a)(i,t);var e=Object(j.a)(i);function i(t,s,n,o){var a;return Object(y.a)(this,i),(a=e.call(this,t,s,n,o)).lastMoveTime=void 0,a.minMoveTime=void 0,a.move=void 0,a.speedMove=1,a.speedRotate=t.PI/80,a.speedBullet=2.5,a.lastMoveTime=Date.now(),a.minMoveTime=3e3,a.move={forward:0,rotation:0},a}return Object(w.a)(i,[{key:"draw",value:function(){var t=this.p5;this.randomMove(),Object(b.a)(Object(g.a)(i.prototype),"draw",this).call(this,t.color(0,255,255))}},{key:"randomMove",value:function(){var t=this.p5,e=Date.now();e<this.lastMoveTime+this.minMoveTime||(this.lastMoveTime=e,this.move.forward=Math.floor(10*Math.random()),this.move.rotation=Math.floor(10*Math.random()));var i=0;i=this.move.forward<=1?0:this.move.forward<=3?-this.speedMove:this.speedMove;var s=this.rotation;this.move.rotation<=1?s-=this.speedRotate:this.move.rotation<=3&&(s+=this.speedRotate),s%=2*t.PI;var n=new O(i*Math.cos(s),i*Math.sin(s)),o=new O(this.position.x,this.position.y);o=o.add(n);var a=new M(o,s,this.size);(function(t,e){var i=t.getBound(),s=e.getBound();return i.top>=s.top&&i.right<=s.right&&i.bottom<=s.bottom&&i.left>=s.left})(a,this.battleField)&&(this.position=o,this.rotation=s,this.body=a)}}]),i}(C),E=i(22),G=i.n(E),L=function(){var t=window.location,e="wss:";return"http:"===t.protocol&&(e="ws:"),e+="//"+t.host},H=function(){function t(e){Object(y.a)(this,t),this.ws=void 0,this.id=void 0,this.id=e}return Object(w.a)(t,[{key:"getConnection",value:function(){var t=Object(m.a)(f.a.mark((function t(){var e,i=this;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=L(),this.ws=new WebSocket("".concat(e,"/websockets?id=").concat(encodeURIComponent(this.id))),t.abrupt("return",new Promise((function(t){i.ws.addEventListener("open",(function(){t(!0)})),i.ws.addEventListener("error",(function(){t(!1)}))})));case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"listenOnMessage",value:function(t){this.ws.addEventListener("message",(function(e){t(e.data)}))}},{key:"sendMessage",value:function(t){this.ws.send(t)}}]),t}(),T=function(){function t(e){var i=this;Object(y.a)(this,t),this.config=void 0,this.p5=void 0,this.sketch=void 0,this.me=void 0,this.robots=void 0,this.players=void 0,this.canvas=void 0,this.score=void 0,this.message=void 0,this.id=void 0,this.config=e,this.robots=[],this.players={},this.id=e.id,this.score={},this.message=new H(this.id),this.p5=new G.a((function(t){t.setup=function(){i.setupGame(t)},t.draw=function(){i.runGame()}}))}return Object(w.a)(t,[{key:"setupGame",value:function(){var t=Object(m.a)(f.a.mark((function t(e){var i,s,n=this;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.sketch=e,(i=document.querySelector("#".concat(this.config.canvasParentId," canvas")))&&i.remove(),this.canvas=e.createCanvas(this.config.width,this.config.height),this.canvas.parent(this.config.canvasParentId),t.next=7,this.message.getConnection();case 7:t.sent&&(s=this.getRandTankStatus(),this.me=new D(this.p5,this.config,this.id,this.message,s),this.message.listenOnMessage(this.handleMessages.bind(this)),setInterval((function(){n.message.sendMessage("pos,".concat(n.me.position.x,",").concat(n.me.position.y,",").concat(n.me.rotation))}),this.config.syncRate));case 9:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"runGame",value:function(){for(var t in this.sketch.background("#F3F3F3"),this.drawScore(),this.me&&this.me.draw(),this.players){this.players[t].draw()}this.checkIfHit()}},{key:"drawScore",value:function(){var t=this,e=this.p5;e.fill(0,0,255),e.stroke(0,0,255),e.textSize(32),Object.keys(this.score).forEach((function(i,s){e.text("".concat(i,": ").concat(t.score[i]),20,40+32*s)}))}},{key:"handleMessages",value:function(t){var e=t.indexOf(","),i=t.substring(0,e),s=t.substring(e+1);switch(i){case"pos":this.updatePlayersPostion(s);break;case"fwd":case"bwd":case"rl":case"rr":this.updatePlayer(i,s);break;case"blt":this.updateBullets(s);break;case"hit":this.updateScore(s);break;case"ext":this.updateExit(s)}}},{key:"updatePlayersPostion",value:function(t){var e=JSON.parse(t);for(var i in e){var s=e[i].split(",");if(i!==this.id){var n={position:new O(+s[0],+s[1]),rotation:+s[2]},o=this.players[i];o?o.updateStatus(n.position,n.rotation):this.players[i]=new I(this.p5,this.config,i,n)}}}},{key:"updatePlayer",value:function(t,e){var i=e.split(","),s=i[0],n=+i[1];if(s!==this.id&&this.players[s]){var o=this.players[s],a=Object(v.a)({},t,!!n);o.tankCommands=Object(l.a)(Object(l.a)({},o.tankCommands),a)}}},{key:"updateScore",value:function(t){this.score=JSON.parse(t)}},{key:"updateBullets",value:function(t){var e=t.split(","),i=Object(h.a)(e,4),s=i[0],n=i[1],o=i[2],a=i[3];if(s!==this.id){var r=this.players[s];r&&r.addBullet(+n,+o,+a)}}},{key:"updateExit",value:function(t){delete this.players[t],delete this.score[t]}},{key:"addRobots",value:function(){var t=this.robots.length;this.robots.push(new F(this.p5,this.config,"robot".concat(t),this.getRandTankStatus()))}},{key:"getRandTankStatus",value:function(){return{position:new O(Math.random()*this.config.width,Math.random()*this.config.height),rotation:2*Math.random()*this.p5.PI}}},{key:"checkIfHit",value:function(){var t=Object(l.a)(Object(l.a)({},this.players),{},Object(v.a)({},this.id,this.me));for(var e in t){var i=t[e];if(i){var s,n=Object(u.a)(i.bullets);try{for(n.s();!(s=n.n()).done;){var o=s.value;if(!o.isHit){var a=new B(o.position,o.radius);for(var r in t)if(r!=e){var h=t[r];P(a,h.body)&&(console.log("tank ".concat(e," bullet hits tank ").concat(r)),e==this.id&&this.message.sendMessage("hit,".concat(this.id)),o.isHit=!0)}}}}catch(d){n.e(d)}finally{n.f()}i.bullets=i.bullets.filter((function(t){return!t.isHit}))}}}}]),t}(),W=(i(32),function(){var t=Object(n.useRef)(null),e=c().gameData;return Object(n.useEffect)((function(){var i=window.innerWidth,s=window.innerHeight,n=t.current;n&&(n.style.width="".concat(i,"px"),n.style.height="".concat(s,"px")),new T({width:i,height:s,canvasParentId:"game-container",syncRate:100,id:e.id})}),[]),Object(s.jsx)("div",{id:"game-container",ref:t})}),N=(i(33),i(5)),J=function(t){return Object(s.jsxs)("div",{id:"debug-info",children:[Object(s.jsxs)("p",{children:["Pos:",t.playerPosition.x.toFixed(2),",",t.playerPosition.y.toFixed(2),",",t.playerPosition.z.toFixed(2)]}),Object(s.jsxs)("p",{children:["Dir:",t.playerRotation.x.toFixed(2),",",t.playerRotation.y.toFixed(2),",",t.playerRotation.z.toFixed(2)]})]})},A=function(){function t(e,i,s,n,o){Object(y.a)(this,t),this.id=void 0,this.radius=void 0,this.position=void 0,this.rotation=void 0,this.speed=void 0,this.isHit=!1,this.material=void 0,this.geo=void 0,this.mesh=void 0,this.scene=void 0,this.scene=e,this.radius=.5,this.speed=o,this.id=i,this.position=s.clone(),this.rotation=n.clone(),this.material=new N.i({color:16711680}),this.geo=new N.l(this.radius,8,8),this.mesh=new N.h(this.geo,this.material),this.mesh.position.set(this.position.x,this.position.y,this.position.z),this.mesh.rotation.set(this.rotation.x,this.rotation.y,this.rotation.z),this.scene.add(this.mesh)}return Object(w.a)(t,[{key:"update",value:function(t,e){var i=this.speed*t;this.mesh.translateOnAxis(new N.m(1,0,0),i),this.isBulletOutSideBoundary(e)&&(this.destory(),this.isHit=!0)}},{key:"isBulletOutSideBoundary",value:function(t){return this.mesh.position.x>t.x||this.mesh.position.x<-t.x||this.mesh.position.y>t.y||this.mesh.position.y<-t.y}},{key:"destory",value:function(){this.geo.dispose(),this.material.dispose(),this.scene.remove(this.mesh),console.log("destory bullet")}}]),t}(),V=function(t){Object(k.a)(i,t);var e=Object(j.a)(i);function i(t,s,n,o,a){var r;return Object(y.a)(this,i),(r=e.call(this,t,s,a)).message=void 0,r.transformStatus=void 0,r.headDirection=void 0,r.boundary=void 0,r.message=n,r.transformStatus={direction:0,rotation:0},r.boundary=o,r.speedMove=20,r.speedRotate=1,r.speedBullet=80,r.bullets=[],r.debug=!1,r.headDirection=new N.m(1,0,0),r}return Object(w.a)(i,[{key:"moveForward",value:function(){1!=this.transformStatus.direction&&this.message.sendMessage("dir,1,".concat(Date.now())),this.transformStatus.direction=1}},{key:"isMovingForward",value:function(){return 1===this.transformStatus.direction}},{key:"moveBackward",value:function(){-1!=this.transformStatus.direction&&this.message.sendMessage("dir,-1,".concat(Date.now())),this.transformStatus.direction=-1}},{key:"isMovingBackward",value:function(){return-1===this.transformStatus.direction}},{key:"stopMoving",value:function(){0!=this.transformStatus.direction&&this.message.sendMessage("dir,0,".concat(Date.now())),this.transformStatus.direction=0}},{key:"isMovingStop",value:function(){return 0===this.transformStatus.direction}},{key:"rotateRight",value:function(){-1!=this.transformStatus.rotation&&this.message.sendMessage("rot,-1,".concat(Date.now())),this.transformStatus.rotation=-1}},{key:"isRotatingRight",value:function(){return-1===this.transformStatus.rotation}},{key:"rotateLeft",value:function(){1!=this.transformStatus.rotation&&this.message.sendMessage("rot,1,".concat(Date.now())),this.transformStatus.rotation=1}},{key:"isRotatingLeft",value:function(){return 1===this.transformStatus.rotation}},{key:"stopRotating",value:function(){0!=this.transformStatus.rotation&&this.message.sendMessage("rot,0,".concat(Date.now())),this.transformStatus.rotation=0}},{key:"isRotatingStop",value:function(){return 0===this.transformStatus.rotation}},{key:"update",value:function(t){var e=this;this.bullets.forEach((function(i){i.update(t,e.boundary)})),this.bullets=this.bullets.filter((function(t){return!t.isHit}))}},{key:"updatePosByServer",value:function(t,e,i){this.mesh.rotation.z=i,this.mesh.position.x=t,this.mesh.position.y=e}},{key:"isTankInBoundary",value:function(){return this.mesh.position.x<this.boundary.x&&this.mesh.position.x>-this.boundary.x&&this.mesh.position.y<this.boundary.y&&this.mesh.position.y>-this.boundary.y}},{key:"updateBoundary",value:function(t){this.boundary=t}}]),i}(function(){function t(e,i,s){Object(y.a)(this,t),this.config=void 0,this.speedMove=void 0,this.speedRotate=void 0,this.speedBullet=void 0,this.id=void 0,this.bullets=void 0,this.allowShoot=!0,this.debug=void 0,this.isLive=!0,this.bodyGeometry=void 0,this.towerGeometry=void 0,this.cannonGeometry=void 0,this.material=void 0,this.mesh=void 0,this.tankCommands=void 0,this.scene=void 0,this.scene=e,this.config=i,this.id=i.id,this.material=new N.i({color:16776960}),this.bodyGeometry=new N.b(8,6,1.2),this.towerGeometry=new N.e(2,2,1,16),this.towerGeometry.rotateX(Math.PI/2),this.towerGeometry.translate(0,0,1.1),this.cannonGeometry=new N.e(.5,.25,8,16),this.cannonGeometry.rotateZ(Math.PI/2),this.cannonGeometry.translate(5,0,1.1),this.bodyGeometry.merge(this.towerGeometry),this.bodyGeometry.merge(this.cannonGeometry),this.mesh=new N.h(this.bodyGeometry,this.material),this.scene.add(this.mesh)}return Object(w.a)(t,[{key:"shoot",value:function(){var t=this.mesh.position.clone().add(new N.m(10,0,1.1).applyEuler(this.mesh.rotation)),e=new A(this.scene,this.id,t,this.mesh.rotation,this.speedBullet);this.bullets.push(e)}}]),t}()),q=i(34),U=function(){function t(e){Object(y.a)(this,t),this.config=void 0,this.score=void 0,this.message=void 0,this.id=void 0,this.scene=void 0,this.camera=void 0,this.renderer=void 0,this.me=void 0,this.players=void 0,this.clock=void 0,this.light=void 0,this.stats=void 0,this.debugContainer=void 0,this.playBoundary=void 0,this.config=e,this.id=e.id,this.score={},this.message=new H(this.id),this.scene=new N.k,this.scene.background=new N.d(11329415),this.camera=new N.j(75,window.innerWidth/window.innerHeight,.1,999),this.camera.position.set(0,0,150),this.camera.lookAt(0,0,-150);var i=new N.a(16777215,.5);this.scene.add(i),this.light=new N.f(16777215,1),this.light.position.set(0,-80,150),this.light.target.position.set(0,0,0),this.scene.add(this.light),this.scene.add(this.light.target),this.renderer=new N.n({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.updatePlayBoundary(),this.stats=new q,this.stats.showPanel(0);var s={playerPosition:new N.m(0,0,0),playerRotation:new N.g(0,0,0)},n=o.a.createElement(J,s),a=document.getElementById(e.canvasParentId);this.debugContainer=document.createElement("div"),this.debugContainer.id="debug-containter",r.a.render(n,this.debugContainer),a.appendChild(this.renderer.domElement),a.appendChild(this.stats.dom),a.appendChild(this.debugContainer),this.registerEvents(),this.clock=new N.c,this.clock.getDelta(),this.animate()}return Object(w.a)(t,[{key:"addMe",value:function(){var t=Object(m.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.message.getConnection();case 2:t.sent&&(this.me=new V(this.scene,this.config,this.message,this.playBoundary),this.message.sendMessage("st3,0,0,0,".concat(this.me.speedMove,",").concat(this.me.speedRotate,",").concat(this.me.speedBullet,",").concat(Date.now())),this.message.listenOnMessage(this.handleMessages.bind(this)));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"animate",value:function(){this.stats.begin();var t=this.clock.getDelta();requestAnimationFrame(this.animate.bind(this)),this.renderer.render(this.scene,this.camera),this.me&&(this.me.update(t),this.updateDebugInfo()),this.stats.end()}},{key:"updateCamera",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}},{key:"updatePlayBoundary",value:function(){var t=new N.m,e=new N.m;t.set(1,1,.5),t.unproject(this.camera),t.sub(this.camera.position).normalize();var i=-this.camera.position.z/t.z;e.copy(this.camera.position).add(t.multiplyScalar(i)),this.playBoundary=e}},{key:"updateDebugInfo",value:function(){var t={playerPosition:this.me.mesh.position,playerRotation:this.me.mesh.rotation},e=o.a.createElement(J,t);r.a.render(e,this.debugContainer)}},{key:"registerEvents",value:function(){var t=this;window.addEventListener("resize",(function(){t.updateCamera(),t.updatePlayBoundary(),t.me&&t.me.updateBoundary(t.playBoundary),t.renderer.setSize(window.innerWidth,window.innerHeight)})),window.addEventListener("keydown",this.keydownListener.bind(this)),window.addEventListener("keyup",this.keyupListener.bind(this))}},{key:"keydownListener",value:function(t){this.me&&("w"===t.key&&this.me.moveForward(),"s"===t.key&&this.me.moveBackward(),"a"===t.key&&this.me.rotateLeft(),"d"===t.key&&this.me.rotateRight()," "===t.key&&this.me.allowShoot&&(this.me.allowShoot=!1,this.me.shoot()))}},{key:"keyupListener",value:function(t){this.me&&("w"===t.key&&this.me.isMovingForward()&&this.me.stopMoving(),"s"===t.key&&this.me.isMovingBackward()&&this.me.stopMoving(),"a"===t.key&&this.me.isRotatingLeft()&&this.me.stopRotating(),"d"===t.key&&this.me.isRotatingRight()&&this.me.stopRotating()," "===t.key&&(this.me.allowShoot=!0))}},{key:"handleMessages",value:function(t){var e=t.indexOf(","),i=t.substring(0,e),s=t.substring(e+1);switch(i){case"pos3":this.updatePlayersPostion(s);break;case"fwd":case"bwd":case"rl":case"rr":this.updatePlayer(i,s);break;case"blt":this.updateBullets(s);break;case"hit":this.updateScore(s);break;case"ext":this.updateExit(s)}}},{key:"updatePlayersPostion",value:function(t){var e=JSON.parse(t);for(var i in e)if(i===this.id){var s=e[i];this.me.updatePosByServer(s.pos.x,s.pos.y,s.pos.r)}}},{key:"updatePlayer",value:function(t,e){var i=e.split(","),s=i[0],n=+i[1];if(s!==this.id&&this.players[s]){var o=this.players[s],a=Object(v.a)({},t,!!n);o.tankCommands=Object(l.a)(Object(l.a)({},o.tankCommands),a)}}},{key:"updateScore",value:function(t){this.score=JSON.parse(t)}},{key:"updateBullets",value:function(t){var e=t.split(",");Object(h.a)(e,1)[0];this.id}},{key:"updateExit",value:function(t){delete this.score[t]}},{key:"addRobots",value:function(){console.log(1)}},{key:"checkIfHit",value:function(){console.log(1)}}]),t}(),X=function(){var t,e=c().gameData;return Object(n.useEffect)((function(){var i=window.innerWidth,s=window.innerHeight;t||(t=new U({width:i,height:s,canvasParentId:"game-container",syncRate:100,id:e.id})).addMe()}),[]),Object(s.jsx)("div",{id:"game-container"})},Z=(i(35),function(){var t=Object(n.useRef)(null),e=Object(n.useRef)(null),i=c(),o=i.setGameData,a=i.gameData;Object(n.useEffect)((function(){e.current&&(e.current.checked=a.engine)}),[]);return Object(s.jsx)("div",{id:"tank-name-form",children:Object(s.jsxs)("form",{onSubmit:function(i){i.preventDefault();var s="",n=!0;t.current&&t.current.value&&(s=t.current.value),e.current&&(n=e.current.checked),o({id:s,engine:n})},children:[Object(s.jsx)("div",{className:"form-div",children:Object(s.jsx)("input",{id:"tank-name",size:50,placeholder:"please name your tank",ref:t})}),Object(s.jsxs)("div",{className:"form-div",children:[Object(s.jsx)("input",{id:"threejs-engine",type:"checkbox",ref:e}),Object(s.jsx)("label",{htmlFor:"threejs-engine",children:"Engine Mode"})]}),Object(s.jsx)("button",{children:"Start"})]})})});var $=function(){var t=Object(n.useState)({id:"",engine:!0}),e=Object(h.a)(t,2),i=e[0],o=e[1];return console.log(i),Object(s.jsx)(d.Provider,{value:{gameData:i,setGameData:o},children:Object(s.jsx)("div",{className:"App",children:i.id?i.engine?Object(s.jsx)(X,{}):Object(s.jsx)(W,{}):Object(s.jsx)(Z,{})})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(Object(s.jsx)($,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[36,1,2]]]);
//# sourceMappingURL=main.46369db6.chunk.js.map