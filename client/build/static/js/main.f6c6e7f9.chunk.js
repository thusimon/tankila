(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{25:function(t,i,e){},26:function(t,i,e){},29:function(t,i,e){},30:function(t,i,e){"use strict";e.r(i);var s=e(5),n=e(4),o=e(17),a=e.n(o),h=(e(25),e(26),e(18)),r=e(15),c=e(3),d=e(12),u=e(10),l=e.n(u),v=e(14),p=e(0),f=e(1),w=e(8),y=e(2),b=e(9),m=e(7),g=function(){function t(i,e){Object(p.a)(this,t),this.x=void 0,this.y=void 0,this.x=i,this.y=e}return Object(f.a)(t,[{key:"add",value:function(i){return new t(this.x+i.x,this.y+i.y)}},{key:"sub",value:function(i){return new t(this.x-i.x,this.y-i.y)}},{key:"rotate",value:function(i){return new t(this.x*Math.cos(i)-this.y*Math.sin(i),this.x*Math.sin(i)+this.y*Math.cos(i))}},{key:"toString",value:function(t){return"".concat(this.x.toFixed(t),",\n").concat(this.y.toFixed(t))}}]),t}(),k=e(13),M=function(){function t(i,e,s){Object(p.a)(this,t),this.position=void 0,this.rotation=void 0,this.size=void 0,this.position=i,this.rotation=e,this.size=s}return Object(f.a)(t,[{key:"getVertexes",value:function(){var t=this.size.w/2,i=this.size.h/2;return[new g(-t,-i).rotate(this.rotation).add(this.position),new g(t,-i).rotate(this.rotation).add(this.position),new g(-t,i).rotate(this.rotation).add(this.position),new g(t,i).rotate(this.rotation).add(this.position)]}},{key:"getBound",value:function(){var t=this.getVertexes(),i=t.map((function(t){return t.y})),e=t.map((function(t){return t.x}));return{top:Math.min.apply(Math,Object(k.a)(i)),right:Math.max.apply(Math,Object(k.a)(e)),bottom:Math.max.apply(Math,Object(k.a)(i)),left:Math.min.apply(Math,Object(k.a)(e))}}}]),t}(),j=function(){function t(i,e,s,n){Object(p.a)(this,t),this.p5=void 0,this.id=void 0,this.radius=void 0,this.position=void 0,this.rotation=void 0,this.speed=void 0,this.isHit=!1,this.p5=i,this.id=e,this.radius=5,this.position=new g(s.x,s.y),this.rotation=n,this.speed=10}return Object(f.a)(t,[{key:"draw",value:function(){var t=this.p5,i=new g(this.speed*Math.cos(this.rotation),this.speed*Math.sin(this.rotation));this.position=this.position.add(i),t.circle(this.position.x,this.position.y,this.radius)}}]),t}(),O=function t(i,e){Object(p.a)(this,t),this.w=void 0,this.h=void 0,this.w=i,this.h=e},x=function(){function t(i,e){Object(p.a)(this,t),this.center=void 0,this.radius=void 0,this.center=i,this.radius=e}return Object(f.a)(t,[{key:"getBound",value:function(){return{top:this.center.y-this.radius,right:this.center.x+this.radius,bottom:this.center.y+this.radius,left:this.center.x-this.radius}}}]),t}(),z=function(t,i,e){return Math.abs(i.x*t.y-t.x*i.y+(e.x*i.y-i.x*e.y)+(t.x*e.y-e.x*t.y))/2},R=function(t,i){var e=i.getVertexes(),s=Object(r.a)(e,4),n=s[0],o=s[1],a=s[2],h=s[3],c=t.center,d=i.size.w*i.size.h;return z(n,o,c)+z(o,a,c)+z(a,h,c)+z(h,n,c)<=d},I=function(){function t(i,e,s,n){Object(p.a)(this,t),this.p5=void 0,this.config=void 0,this.size=void 0,this.halfSize=void 0,this.position=void 0,this.rotation=void 0,this.speedMove=void 0,this.speedRotate=void 0,this.speedBullet=void 0,this.body=void 0,this.battleField=void 0,this.id=void 0,this.bullets=void 0,this.allowFire=!0,this.debug=void 0,this.isLive=!0,this.p5=i,this.config=e,this.size={w:48,h:32},this.halfSize={w:this.size.w/2,h:this.size.h/2},n?(this.position=n.position,this.rotation=n.rotation):(this.position=new g(50,this.config.height-80),this.rotation=0),this.speedMove=2,this.speedRotate=i.PI/40,this.speedBullet=5,this.body=new M(this.position,this.rotation,this.size),this.battleField=new M(new g(e.width/2,e.height/2),0,new O(e.width,e.height)),this.id=s,this.bullets=[],this.debug=!1}return Object(f.a)(t,[{key:"draw",value:function(){var t=this.p5;t.textSize(12),t.push(),t.fill(255,255,255),t.translate(this.position.x,this.position.y),t.rotate(this.rotation),t.rect(-this.halfSize.w,-this.halfSize.h,this.size.w,this.size.h,5),t.rect(0,-this.halfSize.h/4,this.size.w,this.halfSize.h/2),t.pop(),t.fill(255,255,0),this.drawBullets(),this.debug&&(t.fill(0,0,255),this.debugInfo())}},{key:"debugInfo",value:function(){var t=this.p5;new M(this.position,this.rotation,this.size).getVertexes().forEach((function(i){t.text(i.toString(1),i.x,i.y)}))}},{key:"drawBullets",value:function(){var t=this;this.bullets.forEach((function(t){t.draw()})),this.bullets=this.bullets.filter((function(i){return function(t,i){var e=t.getBound(),s=i.getBound();return e.top>=s.top&&e.right<=s.right&&e.bottom<=s.bottom&&e.left>=s.left}(new x(i.position,i.radius),t.battleField)}))}},{key:"nomalizePostion",value:function(t){return new g(t.x/this.config.width,t.y/this.config.height)}},{key:"denomalizePosition",value:function(t){return new g(t.x*this.config.width,t.y*this.config.height)}}]),t}(),B=function(t){Object(b.a)(e,t);var i=Object(m.a)(e);function e(t,s,n,o,a){var h;return Object(p.a)(this,e),(h=i.call(this,t,s,n,a)).message=void 0,h.message=o,h}return Object(f.a)(e,[{key:"draw",value:function(){var t=this,i=this.p5,s=this.rotation,n=new g(this.position.x,this.position.y);i.keyIsDown(65)&&(s-=this.speedRotate,this.sendRotateLeft(!0)),i.keyIsDown(68)&&(s+=this.speedRotate,this.sendRotateRight(!0)),s%=2*i.PI;var o=0;i.keyIsDown(87)&&(o=this.speedMove,this.sendMoveForward(!0)),i.keyIsDown(83)&&(o=-this.speedMove,this.sendMoveBackword(!0));var a=new g(o*Math.cos(s),o*Math.sin(s));n=n.add(a);var h=new M(n,s,this.size);if(this.position=n,this.rotation=s,this.body=h,i.keyIsDown(32)&&this.allowFire){this.allowFire=!1;var r=new g(this.size.w*Math.cos(this.rotation),this.size.w*Math.sin(this.rotation)),c=new j(this.p5,this.id,this.position.add(r),this.rotation);this.message.sendMessage("blt,".concat(c.position.x,",").concat(c.position.y,",").concat(c.rotation)),this.bullets.push(c)}i.keyReleased=function(){32==i.keyCode&&(t.allowFire=!0),65==i.keyCode&&t.sendRotateLeft(!1),68==i.keyCode&&t.sendRotateRight(!1),87==i.keyCode&&t.sendMoveForward(!1),83==i.keyCode&&t.sendMoveBackword(!1)},i.stroke(255,0,0),Object(w.a)(Object(y.a)(e.prototype),"draw",this).call(this)}},{key:"sendMoveForward",value:function(t){this.message.sendMessage("fwd,".concat(t?"1":"0"))}},{key:"sendMoveBackword",value:function(t){this.message.sendMessage("bwd,".concat(t?"1":"0"))}},{key:"sendRotateLeft",value:function(t){this.message.sendMessage("rl,".concat(t?"1":"0"))}},{key:"sendRotateRight",value:function(t){this.message.sendMessage("rr,".concat(t?"1":"0"))}}]),e}(I),S=function(t){Object(b.a)(e,t);var i=Object(m.a)(e);function e(t,s,n,o){var a;return Object(p.a)(this,e),(a=i.call(this,t,s,n,o)).tankCommands=void 0,a.tankCommands={fwd:!1,bwd:!1,rl:!1,rr:!1,blt:!1},a}return Object(f.a)(e,[{key:"updateCommands",value:function(t){this.tankCommands=Object(c.a)(Object(c.a)({},this.tankCommands),t)}},{key:"updateStatus",value:function(t,i){this.position=t,this.rotation=i,this.body=new M(t,i,this.size)}},{key:"draw",value:function(){var t=this.p5,i=this.tankCommands,s=this.rotation,n=new g(this.position.x,this.position.y);i.rl&&(s-=this.speedRotate),i.rr&&(s+=this.speedRotate),s%=2*t.PI;var o=0;i.fwd&&(o=this.speedMove),i.bwd&&(o=-this.speedMove);var a=new g(o*Math.cos(s),o*Math.sin(s));n=n.add(a);var h=new M(n,s,this.size);this.position=n,this.rotation=s,this.body=h,this.p5.stroke(0,0,255),Object(w.a)(Object(y.a)(e.prototype),"draw",this).call(this)}},{key:"addBullet",value:function(t,i,e){var s=new j(this.p5,this.id,new g(t,i),e);this.bullets.push(s)}}]),e}(I),P=function(t){Object(b.a)(e,t);var i=Object(m.a)(e);function e(t,s,n,o){var a;return Object(p.a)(this,e),(a=i.call(this,t,s,n,o)).lastMoveTime=void 0,a.minMoveTime=void 0,a.move=void 0,a.speedMove=1,a.speedRotate=t.PI/80,a.speedBullet=2.5,a.lastMoveTime=Date.now(),a.minMoveTime=3e3,a.move={forward:0,rotation:0},a}return Object(f.a)(e,[{key:"draw",value:function(){this.randomMove(),Object(w.a)(Object(y.a)(e.prototype),"draw",this).call(this)}},{key:"randomMove",value:function(){var t=this.p5,i=Date.now();i<this.lastMoveTime+this.minMoveTime||(this.lastMoveTime=i,this.move.forward=Math.floor(10*Math.random()),this.move.rotation=Math.floor(10*Math.random()));var e=0;e=this.move.forward<=1?0:this.move.forward<=3?-this.speedMove:this.speedMove;var s=this.rotation;this.move.rotation<=1?s-=this.speedRotate:this.move.rotation<=3&&(s+=this.speedRotate),s%=2*t.PI;var n=new g(e*Math.cos(s),e*Math.sin(s)),o=new g(this.position.x,this.position.y);o=o.add(n);var a=new M(o,s,this.size);(function(t,i){var e=t.getBound(),s=i.getBound();return e.top>=s.top&&e.right<=s.right&&e.bottom<=s.bottom&&e.left>=s.left})(a,this.battleField)&&(this.position=o,this.rotation=s,this.body=a)}}]),e}(I),C=e(19),F=e.n(C),E=function(){var t=window.location,i="wss:";return"http:"===t.protocol&&(i="ws:"),i+="//"+t.host},T=function(){function t(i){Object(p.a)(this,t),this.ws=void 0,this.id=void 0,this.id=i}return Object(f.a)(t,[{key:"getConnection",value:function(){var t=Object(v.a)(l.a.mark((function t(){var i,e=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=E(),this.ws=new WebSocket("".concat(i,"/websockets?id=").concat(encodeURIComponent(this.id))),t.abrupt("return",new Promise((function(t){e.ws.addEventListener("open",(function(){t(!0)})),e.ws.addEventListener("error",(function(){t(!1)}))})));case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"listenOnMessage",value:function(t){this.ws.addEventListener("message",(function(i){t(i.data)}))}},{key:"sendMessage",value:function(t){this.ws.send(t)}}]),t}(),D=function(){function t(i){var e=this;Object(p.a)(this,t),this.config=void 0,this.p5=void 0,this.sketch=void 0,this.me=void 0,this.enemies=void 0,this.players=void 0,this.canvas=void 0,this.score=void 0,this.message=void 0,this.id=void 0,this.config=i,this.p5=new F.a((function(t){t.setup=function(){e.setupGame(t)},t.draw=function(){e.runGame()}})),this.enemies=[],this.players={},this.id=(1e4*Math.random()).toFixed(0),this.message=new T(this.id),this.score=0}return Object(f.a)(t,[{key:"setupGame",value:function(){var t=Object(v.a)(l.a.mark((function t(i){var e,s,n=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.sketch=i,(e=document.querySelector("#".concat(this.config.canvasParentId," canvas")))&&e.remove(),this.canvas=i.createCanvas(this.config.width,this.config.height),this.canvas.parent(this.config.canvasParentId),t.next=7,this.message.getConnection();case 7:t.sent&&(s=this.getRandTankStatus(),this.me=new B(this.p5,this.config,this.id,this.message,s),this.message.listenOnMessage(this.handleMessages.bind(this)),setInterval((function(){n.message.sendMessage("pos,".concat(n.me.position.x,",").concat(n.me.position.y,",").concat(n.me.rotation))}),this.config.syncRate));case 9:case"end":return t.stop()}}),t,this)})));return function(i){return t.apply(this,arguments)}}()},{key:"runGame",value:function(){this.sketch.background("#F3F3F3");var t=this.p5;for(var i in t.fill(0,0,255),t.stroke(0,0,255),t.textSize(32),this.p5.text("Score: ".concat(this.score),20,40),this.me&&this.me.draw(),this.players){this.players[i].draw()}this.checkIfHit()}},{key:"handleMessages",value:function(t){var i=t.indexOf(","),e=t.substring(0,i),s=t.substring(i+1);switch(e){case"pos":this.updatePlayersPostion(s);break;case"fwd":case"bwd":case"rl":case"rr":this.updatePlayer(e,s);break;case"blt":this.updateBullets(s);break;case"ext":this.updateExit(s)}}},{key:"updatePlayersPostion",value:function(t){var i=JSON.parse(t);for(var e in i){var s=i[e].split(",");if(e!==this.id){var n={position:new g(+s[0],+s[1]),rotation:+s[2]},o=this.players[e];o?o.updateStatus(n.position,n.rotation):this.players[e]=new S(this.p5,this.config,e,n)}}}},{key:"updatePlayer",value:function(t,i){var e=i.split(","),s=e[0],n=+e[1];if(s!==this.id&&this.players[s]){var o=this.players[s],a=Object(d.a)({},t,!!n);o.tankCommands=Object(c.a)(Object(c.a)({},o.tankCommands),a)}}},{key:"updateBullets",value:function(t){var i=t.split(","),e=Object(r.a)(i,4),s=e[0],n=e[1],o=e[2],a=e[3];if(s!==this.id){var h=this.players[s];h&&h.addBullet(+n,+o,+a)}}},{key:"updateExit",value:function(t){delete this.players[t]}},{key:"addEnemy",value:function(){var t=this.enemies.length;this.enemies.push(new P(this.p5,this.config,"robot".concat(t),this.getRandTankStatus()))}},{key:"getRandTankStatus",value:function(){return{position:new g(Math.random()*this.config.width,Math.random()*this.config.height),rotation:2*Math.random()*this.p5.PI}}},{key:"checkIfHit",value:function(){var t=Object(c.a)(Object(c.a)({},this.players),{},Object(d.a)({},this.id,this.me));for(var i in t){var e=t[i];if(e){var s,n=Object(h.a)(e.bullets);try{for(n.s();!(s=n.n()).done;){var o=s.value;if(!o.isHit){var a=new x(o.position,o.radius);for(var r in t)if(r!=i){var u=t[r];R(a,u.body)&&(console.log("tank ".concat(i," bullet hits tank ").concat(r)),i==this.id&&this.score++,o.isHit=!0)}}}}catch(l){n.e(l)}finally{n.f()}e.bullets=e.bullets.filter((function(t){return!t.isHit}))}}}}]),t}(),H=(e(29),function(){var t=Object(n.useRef)(null);return Object(n.useEffect)((function(){var i=window.innerWidth,e=window.innerHeight,s=t.current;s&&(s.style.width="".concat(i,"px"),s.style.height="".concat(e,"px")),new D({width:i,height:e,canvasParentId:"game-container",syncRate:100})}),[]),Object(s.jsx)("div",{id:"game-container",ref:t})});var L=function(){return Object(s.jsx)("div",{className:"App",children:Object(s.jsx)(H,{})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(Object(s.jsx)(L,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[30,1,2]]]);
//# sourceMappingURL=main.f6c6e7f9.chunk.js.map