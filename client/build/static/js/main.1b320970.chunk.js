(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{25:function(t,i,e){},26:function(t,i,e){},29:function(t,i,e){},30:function(t,i,e){"use strict";e.r(i);var s=e(4),n=e(3),o=e(17),a=e.n(o),h=(e(25),e(26),e(18)),r=e(12),c=e(16),u=e(14),d=e(9),l=e.n(d),v=e(13),p=e(0),f=e(1),w=e(7),y=e(2),b=e(8),g=e(6),m=function(){function t(i,e){Object(p.a)(this,t),this.x=void 0,this.y=void 0,this.x=i,this.y=e}return Object(f.a)(t,[{key:"add",value:function(i){return new t(this.x+i.x,this.y+i.y)}},{key:"sub",value:function(i){return new t(this.x-i.x,this.y-i.y)}},{key:"rotate",value:function(i){return new t(this.x*Math.cos(i)-this.y*Math.sin(i),this.x*Math.sin(i)+this.y*Math.cos(i))}},{key:"toString",value:function(t){return"".concat(this.x.toFixed(t),",\n").concat(this.y.toFixed(t))}}]),t}(),k=e(11),j=function(){function t(i,e,s){Object(p.a)(this,t),this.position=void 0,this.rotation=void 0,this.size=void 0,this.position=i,this.rotation=e,this.size=s}return Object(f.a)(t,[{key:"getVertexes",value:function(){var t=this.size.w/2,i=this.size.h/2;return[new m(-t,-i).rotate(this.rotation).add(this.position),new m(t,-i).rotate(this.rotation).add(this.position),new m(-t,i).rotate(this.rotation).add(this.position),new m(t,i).rotate(this.rotation).add(this.position)]}},{key:"getBound",value:function(){var t=this.getVertexes(),i=t.map((function(t){return t.y})),e=t.map((function(t){return t.x}));return{top:Math.min.apply(Math,Object(k.a)(i)),right:Math.max.apply(Math,Object(k.a)(e)),bottom:Math.max.apply(Math,Object(k.a)(i)),left:Math.min.apply(Math,Object(k.a)(e))}}}]),t}(),O=function(){function t(i,e,s,n){Object(p.a)(this,t),this.p5=void 0,this.id=void 0,this.radius=void 0,this.position=void 0,this.rotation=void 0,this.speed=void 0,this.isHit=!1,this.p5=i,this.id=e,this.radius=5,this.position=new m(s.x,s.y),this.rotation=n,this.speed=10}return Object(f.a)(t,[{key:"draw",value:function(){var t=this.p5,i=new m(this.speed*Math.cos(this.rotation),this.speed*Math.sin(this.rotation));this.position=this.position.add(i),t.circle(this.position.x,this.position.y,this.radius)}}]),t}(),x=function t(i,e){Object(p.a)(this,t),this.w=void 0,this.h=void 0,this.w=i,this.h=e},M=function(){function t(i,e){Object(p.a)(this,t),this.center=void 0,this.radius=void 0,this.center=i,this.radius=e}return Object(f.a)(t,[{key:"getBound",value:function(){return{top:this.center.y-this.radius,right:this.center.x+this.radius,bottom:this.center.y+this.radius,left:this.center.x-this.radius}}}]),t}(),z=function(t,i){var e=t.getBound(),s=i.getBound();return e.top>=s.top&&e.right<=s.right&&e.bottom<=s.bottom&&e.left>=s.left},I=function(t,i,e){return Math.abs(i.x*t.y-t.x*i.y+(e.x*i.y-i.x*e.y)+(t.x*e.y-e.x*t.y))/2},S=function(t,i){var e=i.getVertexes(),s=Object(u.a)(e,4),n=s[0],o=s[1],a=s[2],h=s[3],r=t.center,c=i.size.w*i.size.h;return I(n,o,r)+I(o,a,r)+I(a,h,r)+I(h,n,r)<=c},B=function(){function t(i,e,s,n){Object(p.a)(this,t),this.p5=void 0,this.config=void 0,this.size=void 0,this.halfSize=void 0,this.position=void 0,this.rotation=void 0,this.speedMove=void 0,this.speedRotate=void 0,this.speedBullet=void 0,this.body=void 0,this.battleField=void 0,this.id=void 0,this.bullets=void 0,this.allowFire=!0,this.debug=void 0,this.isLive=!0,this.p5=i,this.config=e,this.size={w:48,h:32},this.halfSize={w:this.size.w/2,h:this.size.h/2},n?(this.position=n.position,this.rotation=n.rotation):(this.position=new m(50,this.config.height-80),this.rotation=0),this.speedMove=2,this.speedRotate=i.PI/40,this.speedBullet=5,this.body=new j(this.position,this.rotation,this.size),this.battleField=new j(new m(e.width/2,e.height/2),0,new x(e.width,e.height)),this.id=s,this.bullets=[],this.debug=!1}return Object(f.a)(t,[{key:"draw",value:function(){var t=this.p5;t.textSize(12),t.push(),t.fill(255,255,255),t.translate(this.position.x,this.position.y),t.rotate(this.rotation),t.rect(-this.halfSize.w,-this.halfSize.h,this.size.w,this.size.h,5),t.rect(0,-this.halfSize.h/4,this.size.w,this.halfSize.h/2),t.pop(),t.fill(255,255,0),this.drawBullets(),this.debug&&(t.fill(0,0,255),this.debugInfo())}},{key:"debugInfo",value:function(){var t=this.p5;new j(this.position,this.rotation,this.size).getVertexes().forEach((function(i){t.text(i.toString(1),i.x,i.y)}))}},{key:"drawBullets",value:function(){var t=this;this.bullets.forEach((function(t){t.draw()})),this.bullets=this.bullets.filter((function(i){return function(t,i){var e=t.getBound(),s=i.getBound();return e.top>=s.top&&e.right<=s.right&&e.bottom<=s.bottom&&e.left>=s.left}(new M(i.position,i.radius),t.battleField)}))}},{key:"nomalizePostion",value:function(t){return new m(t.x/this.config.width,t.y/this.config.height)}},{key:"denomalizePosition",value:function(t){return new m(t.x*this.config.width,t.y*this.config.height)}}]),t}(),F=function(t){Object(b.a)(e,t);var i=Object(g.a)(e);function e(t,s,n,o,a){var h;return Object(p.a)(this,e),(h=i.call(this,t,s,n,a)).message=void 0,h.message=o,h}return Object(f.a)(e,[{key:"draw",value:function(){var t=this,i=this.p5,s=this.rotation,n=new m(this.position.x,this.position.y);i.keyIsDown(65)&&(s-=this.speedRotate),i.keyIsDown(68)&&(s+=this.speedRotate),s%=2*i.PI;var o=0;i.keyIsDown(87)&&(o=this.speedMove),i.keyIsDown(83)&&(o=-this.speedMove),s%=2*i.PI;var a=new m(o*Math.cos(s),o*Math.sin(s));n=n.add(a);var h=new j(n,s,this.size);if(z(h,this.battleField)&&(this.position=n,this.rotation=s,this.body=h),i.keyIsDown(32)&&this.allowFire){this.allowFire=!1;var r=new m(this.size.w*Math.cos(this.rotation),this.size.w*Math.sin(this.rotation)),c=new O(this.p5,this.id,this.position.add(r),this.rotation);this.message.sendMessage("blt,".concat(c.position.x,",").concat(c.position.y,",").concat(c.rotation)),this.bullets.push(c)}i.keyReleased=function(){32==i.keyCode&&(t.allowFire=!0)},i.stroke(255,0,0),this.message.sendMessage("pos,".concat(this.position.x,",").concat(this.position.y,",").concat(this.rotation)),Object(w.a)(Object(y.a)(e.prototype),"draw",this).call(this)}}]),e}(B),P=function(t){Object(b.a)(e,t);var i=Object(g.a)(e);function e(){return Object(p.a)(this,e),i.apply(this,arguments)}return Object(f.a)(e,[{key:"updateStatus",value:function(t,i){this.position=t,this.rotation=i,this.body=new j(t,i,this.size)}},{key:"draw",value:function(){this.p5.stroke(0,0,255),Object(w.a)(Object(y.a)(e.prototype),"draw",this).call(this)}},{key:"addBullet",value:function(t,i,e){var s=new O(this.p5,this.id,new m(t,i),e);this.bullets.push(s)}}]),e}(B),R=function(t){Object(b.a)(e,t);var i=Object(g.a)(e);function e(t,s,n,o){var a;return Object(p.a)(this,e),(a=i.call(this,t,s,n,o)).lastMoveTime=void 0,a.minMoveTime=void 0,a.move=void 0,a.speedMove=1,a.speedRotate=t.PI/80,a.speedBullet=2.5,a.lastMoveTime=Date.now(),a.minMoveTime=3e3,a.move={forward:0,rotation:0},a}return Object(f.a)(e,[{key:"draw",value:function(){this.randomMove(),Object(w.a)(Object(y.a)(e.prototype),"draw",this).call(this)}},{key:"randomMove",value:function(){var t=this.p5,i=Date.now();i<this.lastMoveTime+this.minMoveTime||(this.lastMoveTime=i,this.move.forward=Math.floor(10*Math.random()),this.move.rotation=Math.floor(10*Math.random()));var e=0;e=this.move.forward<=1?0:this.move.forward<=3?-this.speedMove:this.speedMove;var s=this.rotation;this.move.rotation<=1?s-=this.speedRotate:this.move.rotation<=3&&(s+=this.speedRotate),s%=2*t.PI;var n=new m(e*Math.cos(s),e*Math.sin(s)),o=new m(this.position.x,this.position.y);o=o.add(n);var a=new j(o,s,this.size);z(a,this.battleField)&&(this.position=o,this.rotation=s,this.body=a)}}]),e}(B),E=e(19),T=e.n(E),D=function(){var t=window.location,i="wss:";return"http:"===t.protocol&&(i="ws:"),i+="//"+t.host},H=function(){function t(i){Object(p.a)(this,t),this.ws=void 0,this.id=void 0,this.id=i}return Object(f.a)(t,[{key:"getConnection",value:function(){var t=Object(v.a)(l.a.mark((function t(){var i,e=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=D(),this.ws=new WebSocket("".concat(i,"/websockets?id=").concat(encodeURIComponent(this.id))),t.abrupt("return",new Promise((function(t){e.ws.addEventListener("open",(function(){t(!0)})),e.ws.addEventListener("error",(function(){t(!1)}))})));case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"listenOnMessage",value:function(t){this.ws.addEventListener("message",(function(i){t(i.data)}))}},{key:"sendMessage",value:function(t){this.ws.send(t)}}]),t}(),C=function(){function t(i){var e=this;Object(p.a)(this,t),this.config=void 0,this.p5=void 0,this.sketch=void 0,this.me=void 0,this.enemies=void 0,this.players=void 0,this.canvas=void 0,this.score=void 0,this.message=void 0,this.id=void 0,this.config=i,this.p5=new T.a((function(t){t.setup=function(){e.setupGame(t)},t.draw=function(){e.runGame()}})),this.enemies=[],this.players={},this.id=(1e4*Math.random()).toFixed(0),this.message=new H(this.id),this.score=0}return Object(f.a)(t,[{key:"setupGame",value:function(){var t=Object(v.a)(l.a.mark((function t(i){var e;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.sketch=i,(e=document.querySelector("#".concat(this.config.canvasParentId," canvas")))&&e.remove(),this.canvas=i.createCanvas(this.config.width,this.config.height),this.canvas.parent(this.config.canvasParentId),t.next=7,this.message.getConnection();case 7:t.sent&&(this.me=new F(this.p5,this.config,this.id,this.message,this.getRandTankStatus()),this.message.listenOnMessage(this.handleMessages.bind(this)));case 9:case"end":return t.stop()}}),t,this)})));return function(i){return t.apply(this,arguments)}}()},{key:"runGame",value:function(){this.sketch.background("#F3F3F3");var t=this.p5;for(var i in t.fill(0,0,255),t.stroke(0,0,255),t.textSize(32),this.p5.text("Score: ".concat(this.score),20,40),this.me&&this.me.draw(),this.players){this.players[i].draw()}this.checkIfHit()}},{key:"handleMessages",value:function(t){var i=t.indexOf(","),e=t.substring(0,i),s=t.substring(i+1);switch(e){case"pos":this.updatePlayers(s);break;case"blt":this.updateBullets(s);break;case"ext":this.updateExit(s)}}},{key:"updatePlayers",value:function(t){var i=JSON.parse(t);for(var e in delete i[this.id],i){var s=i[e].split(","),n=new m(+s[0],+s[1]),o=+s[2],a=this.players[e];if(a)a.updateStatus(n,o);else{var h=new P(this.p5,this.config,e);h.updateStatus(n,o),this.players[e]=h}}}},{key:"updateBullets",value:function(t){var i=t.split(","),e=Object(u.a)(i,4),s=e[0],n=e[1],o=e[2],a=e[3];if(s!==this.id){var h=this.players[s];h&&h.addBullet(+n,+o,+a)}}},{key:"updateExit",value:function(t){delete this.players[t]}},{key:"addEnemy",value:function(){var t=this.enemies.length;this.enemies.push(new R(this.p5,this.config,"robot".concat(t),this.getRandTankStatus()))}},{key:"getRandTankStatus",value:function(){return{position:new m(Math.random()*this.config.width,Math.random()*this.config.height),rotation:2*Math.random()*this.p5.PI}}},{key:"checkIfHit",value:function(){var t=Object(c.a)(Object(c.a)({},this.players),{},Object(r.a)({},this.id,this.me));for(var i in t){var e=t[i];if(e){var s,n=Object(h.a)(e.bullets);try{for(n.s();!(s=n.n()).done;){var o=s.value;if(!o.isHit){var a=new M(o.position,o.radius);for(var u in t)if(u!=i){var d=t[u];S(a,d.body)&&(console.log("tank ".concat(i," bullet hits tank ").concat(u)),i==this.id&&this.score++,o.isHit=!0)}}}}catch(l){n.e(l)}finally{n.f()}e.bullets=e.bullets.filter((function(t){return!t.isHit}))}}}}]),t}(),G=(e(29),function(){var t=Object(n.useRef)(null);return Object(n.useEffect)((function(){var i=window.innerWidth,e=window.innerHeight,s=t.current;s&&(s.style.width="".concat(i,"px"),s.style.height="".concat(e,"px")),new C({width:i,height:e,canvasParentId:"game-container"})}),[]),Object(s.jsx)("div",{id:"game-container",ref:t})});var L=function(){return Object(s.jsx)("div",{className:"App",children:Object(s.jsx)(G,{})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(Object(s.jsx)(L,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[30,1,2]]]);
//# sourceMappingURL=main.1b320970.chunk.js.map